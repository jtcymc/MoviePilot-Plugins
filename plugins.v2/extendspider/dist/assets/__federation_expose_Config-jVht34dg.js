import{importShared as G}from"./__federation_fn_import-E6wRZccp.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const{createTextVNode:c,resolveComponent:r,withCtx:t,createVNode:o,toDisplayString:b,openBlock:y,createBlock:N,createCommentVNode:de,createElementVNode:C,renderList:D,Fragment:F,createElementBlock:O,withKeys:ce,withModifiers:pe}=await G("vue"),ue={class:"plugin-config"},_e={class:"d-flex align-center"},fe={class:"d-flex justify-end mt-4"},{ref:x,reactive:S,onMounted:me,computed:be}=await G("vue"),ge={__name:"Config",props:{initialConfig:{type:Object,default:()=>({})},api:{default:()=>{}}},emits:["save","close","switch"],setup(P,{emit:M}){const m=P,I=x(null),V=x(!0),i=x(""),B=x(!1),u={Bt1louSpider:{spider_name:"Bt1louSpider",spider_enable:!0,spider_proxy:!1,pass_cloud_flare:!0,proxy_type:"playwright",spider_desc:"BT之家1LOU站-回归初心，追求极简",spider_tags:[]},BtBtlSpider:{spider_name:"BtBtlSpider",spider_enable:!0,spider_proxy:!1,proxy_type:"playwright",spider_desc:"BT影视_4k高清电影BT下载_蓝光迅雷电影下载_最新电视剧下载"},BtBuLuoSpider:{spider_name:"BtBuLuoSpider",spider_enable:!0,spider_proxy:!1,proxy_type:"playwright",spider_desc:"BT部落天堂 - 注重体验与质量的影视资源下载网站"},BtdxSpider:{spider_name:"BtdxSpider",spider_enable:!0,spider_proxy:!1,proxy_type:"playwright",spider_desc:"比特大雄_BT电影天堂_最新720P、1080P高清电影BT种子免注册下载网站"},BtttSpider:{spider_name:"BtttSpider",spider_enable:!0,spider_proxy:!1,proxy_type:"playwright",spider_desc:"BT天堂 - 2025最新高清电影1080P|2160P|4K资源免费下载"},Dytt8899Spider:{spider_name:"Dytt8899Spider",spider_enable:!0,spider_proxy:!1,proxy_type:"playwright",spider_desc:"电影天堂_电影下载_高清首发"},Bt0lSpider:{spider_name:"Bt0lSpider",spider_enable:!0,spider_proxy:!1,proxy_type:"playwright",spider_desc:"不太灵-影视管理系统"},CiLiXiongSpider:{spider_name:"CiLiXiongSpider",spider_enable:!0,spider_proxy:!1,pass_cloud_flare:!0,proxy_type:"playwright",spider_desc:"磁力熊，支持完结影视"},GyingKSpider:{spider_name:"GyingKSpider",spider_enable:!0,spider_proxy:!1,pass_cloud_flare:!1,proxy_type:"playwright",spider_desc:"观影 GYING",spider_username:"",spider_password:""}},s=S({enabled:!1,cron:"0 0 */24 * *",onlyonce:!1,spider_config:{...u},tags:[]});x(Object.values(s.spider_config));const g=S({}),h=S({});x("");const _=S({});me(async()=>{try{const l=await m.api.get("plugin/ExtendSpider/initial_config");if(l&&l.success){const e=l.data;Object.assign(s,e),e.spider_config&&(s.spider_config={...u,...e.spider_config})}else Object.assign(s,{enabled:!1,cron:"0 0 */24 * *",onlyonce:!1,spider_config:{...u}});Object.keys(s.spider_config).forEach(e=>{g[e]=JSON.stringify(s.spider_config[e],null,2),_[e]=""})}catch(l){console.error("获取配置失败:",l),i.value=l.message||"获取配置失败",Object.assign(s,{enabled:!1,cron:"0 0 */24 * *",onlyonce:!1,spider_config:{...u}})}});const k=M;async function R(l){try{const e=await m.api.post("plugin/ExtendSpider/toggle_spider",{spider_name:l});e.success?i.value=null:i.value=e.message}catch(e){i.value=e.message||"操作失败"}}function X(l){try{const e=JSON.parse(g[l]);if(!e.spider_name||!e.spider_desc)throw new Error("配置缺少必要字段");s.spider_config[l]=e,h[l]=""}catch{h[l]="JSON格式错误或缺少必要字段"}}async function q(l){try{const e=await m.api.post("plugin/ExtendSpider/reset_config",{spider_name:l});e.success?(s.spider_config[l]={...u[l]},g[l]=JSON.stringify(u[l],null,2),i.value=null):i.value=e.message}catch(e){i.value=e.message||"重置失败"}}async function A(){try{const l=await m.api.post("plugin/ExtendSpider/reset_all_config");l.success?(s.spider_config={...u},Object.keys(u).forEach(e=>{g[e]=JSON.stringify(u[e],null,2)}),i.value=null):i.value=l.message}catch(l){i.value=l.message||"重置失败"}}async function E(){if(!V.value){i.value="请修正表单错误";return}B.value=!0,i.value=null;try{k("save",{...s})}catch(l){console.error("保存配置失败:",l),i.value=l.message||"保存配置失败"}finally{B.value=!1}}function Y(){k("switch")}function z(){k("close")}async function T(l){if(_[l])try{await m.api.post("plugin/ExtendSpider/add_tag",{spider_name:l,tag:_[l]}),s.spider_config[l].spider_tags||(s.spider_config[l].spider_tags=[]),s.spider_config[l].spider_tags.push(_[l]),_[l]=""}catch(e){console.error("添加标签失败:",e),i.value=e.message||"添加标签失败"}}async function H(l,e){try{await m.api.post("plugin/ExtendSpider/remove_tag",{spider_name:l,tag:e});const f=s.spider_config[l].spider_tags.indexOf(e);f>-1&&s.spider_config[l].spider_tags.splice(f,1)}catch(f){console.error("删除标签失败:",f),i.value=f.message||"删除标签失败"}}function Q(l){l&&window.open(l,"_blank")}return(l,e)=>{const f=r("v-card-title"),j=r("v-icon"),v=r("v-btn"),W=r("v-card-item"),Z=r("v-alert"),w=r("v-switch"),U=r("v-text-field"),J=r("v-card-text"),K=r("v-card"),ee=r("v-expansion-panel-title"),p=r("v-col"),le=r("v-select"),L=r("v-textarea"),$=r("v-row"),oe=r("v-chip"),te=r("v-chip-group"),ne=r("v-expansion-panel-text"),ae=r("v-expansion-panel"),se=r("v-expansion-panels"),re=r("v-form");return y(),O("div",ue,[o(K,null,{default:t(()=>[o(W,null,{append:t(()=>[o(v,{icon:"",color:"primary",variant:"text",onClick:z},{default:t(()=>[o(j,{left:""},{default:t(()=>e[4]||(e[4]=[c("mdi-close")])),_:1})]),_:1})]),default:t(()=>[o(f,null,{default:t(()=>e[3]||(e[3]=[c("爬虫配置")])),_:1})]),_:1}),o(J,{class:"overflow-y-auto"},{default:t(()=>[i.value?(y(),N(Z,{key:0,type:"error",class:"mb-4"},{default:t(()=>[c(b(i.value),1)]),_:1})):de("",!0),o(re,{ref_key:"form",ref:I,modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=n=>V.value=n),onSubmit:pe(E,["prevent"])},{default:t(()=>[o(K,{class:"mb-4"},{default:t(()=>[o(f,null,{default:t(()=>e[5]||(e[5]=[c("基础设置")])),_:1}),o(J,null,{default:t(()=>[o(w,{modelValue:s.enabled,"onUpdate:modelValue":e[0]||(e[0]=n=>s.enabled=n),label:"启用插件",color:"primary","hide-details":"",class:"mb-4"},null,8,["modelValue"]),o(U,{modelValue:s.cron,"onUpdate:modelValue":e[1]||(e[1]=n=>s.cron=n),label:"更新周期",hint:"Cron表达式，例如：0 */6 * * *","persistent-hint":"",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1})]),_:1}),e[12]||(e[12]=C("div",{class:"text-subtitle-1 font-weight-bold mt-4 mb-2"},"爬虫配置",-1)),o(se,{variant:"accordion"},{default:t(()=>[(y(!0),O(F,null,D(s.spider_config,(n,d)=>(y(),N(ae,{key:d},{default:t(()=>[o(ee,null,{default:t(()=>[C("div",_e,[o(j,{color:n.spider_enable?"success":"error",class:"mr-2"},{default:t(()=>[c(b(n.spider_enable?"mdi-check-circle":"mdi-close-circle"),1)]),_:2},1032,["color"]),c(" "+b(n.spider_name)+" - "+b(n.spider_desc),1)])]),_:2},1024),o(ne,null,{default:t(()=>[o($,null,{default:t(()=>[o(p,{cols:"12",md:"6"},{default:t(()=>[o(w,{modelValue:n.spider_enable,"onUpdate:modelValue":a=>n.spider_enable=a,label:"启用爬虫",color:"primary",inset:"",onChange:a=>R(d)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),o(p,{cols:"12",md:"6"},{default:t(()=>[o(w,{modelValue:n.spider_proxy,"onUpdate:modelValue":a=>n.spider_proxy=a,label:"使用代理",color:"primary",inset:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(p,{cols:"12",md:"6"},{default:t(()=>[o(w,{modelValue:n.pass_cloud_flare,"onUpdate:modelValue":a=>n.pass_cloud_flare=a,label:"绕过CloudFlare",color:"primary",inset:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(p,{cols:"12",md:"6"},{default:t(()=>[o(le,{modelValue:n.proxy_type,"onUpdate:modelValue":a=>n.proxy_type=a,label:"代理类型",items:["playwright","requests"],variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(p,{cols:"12",md:"6"},{default:t(()=>[o(L,{modelValue:n.spider_desc,"onUpdate:modelValue":a=>n.spider_desc=a,label:"爬虫描述",variant:"outlined",rows:"2",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(p,{cols:"12",md:"6"},{default:t(()=>[o(U,{modelValue:n.spider_url,"onUpdate:modelValue":a=>n.spider_url=a,label:"爬虫网址",variant:"outlined",readonly:"","append-icon":n.spider_url?"mdi-open-in-new":"","onClick:append":a=>Q(n.spider_url)},null,8,["modelValue","onUpdate:modelValue","append-icon","onClick:append"])]),_:2},1024),o(p,{cols:"12"},{default:t(()=>[e[7]||(e[7]=C("div",{class:"text-subtitle-1 mb-2"},"标签管理",-1)),o($,null,{default:t(()=>[o(p,{cols:"12",sm:"8"},{default:t(()=>[o(U,{modelValue:_[d],"onUpdate:modelValue":a=>_[d]=a,label:"添加新标签",variant:"outlined",density:"comfortable",onKeyup:ce(a=>T(d),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1024),o(p,{cols:"12",sm:"4",class:"d-flex align-center"},{default:t(()=>[o(v,{color:"primary",block:"",onClick:a=>T(d),disabled:!_[d]},{default:t(()=>e[6]||(e[6]=[c(" 添加标签 ")])),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024),o(te,{class:"mt-4"},{default:t(()=>[(y(!0),O(F,null,D(n.spider_tags||[],a=>(y(),N(oe,{key:a,color:"primary",variant:"outlined",closable:"","onClick:close":ve=>H(d,a),class:"ma-1"},{default:t(()=>[c(b(a),1)]),_:2},1032,["onClick:close"]))),128))]),_:2},1024)]),_:2},1024),o(p,{cols:"12"},{default:t(()=>[o(L,{modelValue:g[d],"onUpdate:modelValue":[a=>g[d]=a,a=>X(d)],label:"爬虫配置（JSON格式）",variant:"outlined",rows:"6","error-messages":h[d]},null,8,["modelValue","onUpdate:modelValue","error-messages"])]),_:2},1024),o(p,{cols:"12",class:"d-flex justify-end"},{default:t(()=>[o(v,{color:"warning",variant:"outlined",class:"mr-2",onClick:a=>q(d)},{default:t(()=>e[8]||(e[8]=[c(" 重置配置 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),C("div",fe,[o(v,{color:"warning",variant:"outlined",class:"mr-2",onClick:A},{default:t(()=>e[9]||(e[9]=[c(" 重置所有配置 ")])),_:1}),o(v,{color:"info",variant:"outlined",class:"mr-2",onClick:Y},{default:t(()=>e[10]||(e[10]=[c(" 切换到详情 ")])),_:1}),o(v,{color:"primary",disabled:!V.value,onClick:E,loading:B.value},{default:t(()=>e[11]||(e[11]=[c(" 保存配置 ")])),_:1},8,["disabled","loading"])])]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}},Ve=ie(ge,[["__scopeId","data-v-e0b198a7"]]);export{Ve as default};
